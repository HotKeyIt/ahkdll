CriticalSection(cs:=0){
  static i:=0,crisec:={base:{}},init:=crisec.base.DefineMethod("__Delete",Func("CriticalSecion")
  if IsObject(cs){
    Loop i
      DeleteCriticalSection(c%i%.Ptr)
    Return i:=0
  } else if cs
    return (DeleteCriticalSection(cs),cs)
  Return (i++,c%i%:=BufferAlloc(24),InitializeCriticalSection(c%i%.Ptr),c%i%.Ptr)
}
